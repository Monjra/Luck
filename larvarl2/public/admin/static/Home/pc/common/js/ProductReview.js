function allRating(e){$.ajax({type:"POST",async:!1,url:"allRating.php",data:{modelid:e},contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",success:function(e){1==e.success&&($("#avgRatingImg").css("width",34*e.data.avg_socre),$("#avgRatingCount").html(e.data.avg_socre.toFixed(1)),$("#ReviewAllCount").html(e.data.comment_count),$(".productReview ").html("评价详情 "+e.data.comment_count+"<i class='inline'></i>"))},error:function(){},beforeSend:function(){}})}function supplierRating(e){$.ajax({type:"POST",async:!1,url:window.ControllerSite+"/product/supplierRating",data:{supplier:e},contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",success:function(e){1==e.success&&($("#desc_score").find(".scoreImg").css("width",22*e.data.desc_score),$("#desc_score").find(".score").html(e.data.desc_score.toFixed(1)+"分"),$("#service_score").find(".scoreImg").css("width",22*e.data.service_score),$("#service_score").find(".score").html(e.data.service_score.toFixed(1)+"分"),$("#logistics_score").find(".scoreImg").css("width",22*e.data.logistics_score),$("#logistics_score").find(".score").html(e.data.logistics_score.toFixed(1)+"分"))},error:function(){},beforeSend:function(){}})}function ReviewList(e,a,t){$.ajax({type:"POST",async:!1,url:window.ControllerSite+"/product/ReviewList",data:{modelid:e,page_index:a,page_size:t},contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",success:function(e){1==e.success&&e.data.post.length>0?(ReviewListHTML(e),totalpage=parseInt(e.data.pageCount),setpage(),$(".productReview").attr("show",1)):$(".evaluateItem").html("暂时没有评论哦。")},error:function(){$(".evaluateItem").html("暂时没有评论哦。")},beforeSend:function(){}})}function ReviewListHTML(e){var a="",t=e.data.post;$.each(t,function(){var e=22*this.score,t=this.img?this.img.split(","):[],i=this.reply,s=this.create_time,c="";c=this.nickname.length>2?this.nickname[0]+"****"+this.nickname[this.nickname.length-1]:this.nickname[0]+"****",a+="<div class='evaluateBox'>",a+="<div class='cmImg'><img src='"+this.product_img+"' width='100' height='100' alt=''></div>",a+="<div class='evaluateCon'>",a+="<h3 class='relative title'>",a+="<span class='inline mg_r20'><em class='smXjGray inline spIcon'><i class='smXjF60 inline spIcon' style='width:"+e+"px'></i></em> </span> ",a+=" <span class='inline'>来自 "+c+"</span>","0"!=this.orderid&&"-1"!=this.orderid&&(a+="<span class='inline mg_r15'style='float:right;'>订单号 "+this.orderid+"</span>"),a+="</h3>",a+="<table class='evalTab' cellspacing='0' cellpadding='0' width='100%'><tbody><tr>",a+="<td colspan='3' width='100%' class='col_666'>"+this.content+"</td></tr>",a+="<tr><td colspan='3'><ul class='sizeZero mg_t5'>",$.each(t,function(){var e=this.split("."),t=[];t=e.slice(0),t.pop();var i=t.join("."),s=i+"_128."+e[e.length-1];a+="<li class='inline mg_r10 cursor'><img src='"+s+"' width='50' height='50' onclick='showBigImg(\""+this+"\")'></li>"}),a+="</ul></td></tr>",a+="<tr><td colspan='3'><div class='mg_t10'>",a+="<span class='inline col_999 mg_r40'>"+s+"</span>",a+="</div></td></tr>",i.length>0&&(a+="<tr><td colspan='3' width='100%' class='col_666'>",$.each(i,function(){10==this.role&&(a+="<p class='pd_t10 pd_l10 mg_t10 col_666'><span class='col_f27a0a'>["+JSDateDiffAfter(s,this.create_time)+"后追评]</span>"+this.content+"</p>"),20==this.role&&(a+="<div class='mg_t20 sup_reply_bg'>",a+="<dl class='clearfix sever_reply '><dt class='f_l w65 col_f27a0a'>商家回复：</dt>",a+="<dd>"+this.content+"</dd></dl>",a+="</div>"),30==this.role&&(a+="<div class='mg_t20 sup_reply_bg'>",a+="<dl class='clearfix sever_reply '><dt class='f_l w65 col_724a87'>平台回复：</dt>",a+="<dd>"+this.content+"</dd></dl>",a+="</div>")}),a+="</td></tr>"),a+="</tbody></table></div></div>"}),$(".evaluateItem").html(a)}function showBigImg(e){$(this).dialogFn({type:"alert",title:"",btnshow:!1,content:"<img src='"+e+"' width=100% id='bigImg'/>",showAfter:function(){$(".pop_mark").click(function(){$(".pop_close").click()}),$("#bigImg").load(function(){var e=$(this).width(),a=$(this).height(),t=$(window).height()/2-a/2,i=$(window).width()/2-e/2;$(".J_pop").css({top:t,left:i})})}})}function gotopage(e){cpage=e,window.location.href="#Reviewtop",ReviewList(designData.ModelId,cpage,pagesize)}function setpage(){var e,a="";if(pagesize>=totalpage)for(e=1;totalpage>=e;e++)a=e!=cpage?a+"<a href='javascript:void(0)' onclick='gotopage("+e+")'>"+e+"</a>":a+"<a href='javascript:void(0)' class='checked'>"+e+"</a>";if(totalpage>pagesize)if(0==parseInt((cpage-1)/pagesize)){for(e=1;pagesize>=e;e++)a=e!=cpage?a+"<a href='javascript:void(0)' onclick='gotopage("+e+")'>"+e+"</a>":a+"<a href='javascript:void(0)' class='checked'>"+e+"</a>";totalpage>=e&&(a=a+"<a href='javascript:void(0)' onclick='gotopage("+e+")'class='nextDf'> >> </a>")}else if(parseInt((cpage-1)/pagesize)==parseInt(totalpage/pagesize))for(a=a+"<a href='javascript:void(0)' onclick='gotopage("+parseInt((cpage-1)/pagesize)*pagesize+")'class='nextDf'> << </a>",e=parseInt(totalpage/pagesize)*pagesize+1;totalpage>=e;e++)a=e!=cpage?a+"<a href='javascript:void(0)' onclick='gotopage("+e+")'>"+e+"</a>":a+"<a href='javascript:void(0)' class='checked'>"+e+"</a>";else{for(a=a+"<a href='javascript:void(0)' onclick='gotopage("+parseInt((cpage-1)/pagesize)*pagesize+")'class='nextDf'> << </a>",e=parseInt((cpage-1)/pagesize)*pagesize+1;e<=parseInt((cpage-1)/pagesize)*pagesize+pagesize;e++)a=e!=cpage?a+"<a href='javascript:void(0)' onclick='gotopage("+e+")'>"+e+"</a>":a+"<a href='javascript:void(0)' class='checked'>"+e+"</a>";totalpage>=e&&(a=a+"<a href='javascript:void(0)' onclick='gotopage("+e+")'class='nextDf'> >> </a>")}document.getElementById("pagerDiv").innerHTML="<div id='setpage'>"+a+"</div>",a=""}var totalpage,pagesize,cpage;cpage=1,totalpage=0,pagesize=10,allRating(designData.ModelId);