LT.namespace("LT.myOrder_refund4"),LT.myOrder_refund4=function(){var e,t,a=LT.Form.Config,t={bindEvent:function(){$(document).on("click",function(){$(".sel_p").hide()}),$(document).delegate(".select_box","click",function(e){$(this).siblings().children("ul").hide(),t._selectShow(e,$(this)),sVal=$(this).children("span").attr("value"),sText=$(this).children("span").html(),$(this).children("input").val(sVal),LT.downBox($(this),$(this).children("ul")),e.stopPropagation()}),$(document).delegate(".J_apply_refund","click",function(e){var t=$(this),a={orderId:t.data("orderid"),orderDetailId:t.data("detailid"),version:0};$.ajax({url:window.ControllerSite+"/MyCenter/CheckCanReturn",dataType:"json",type:"POST",data:a,success:function(e){1==e.success?(result=e.data.result,210003==result?LT.alertSmall("此商品正在退款中，请等待处理。"):0==result?location.href=window.ControllerSite+"/MyCenter/applayrefund.html?version=0&orderId="+a.orderId+"&orderDetailId="+a.orderDetailId:LT.alertSmall(210001==result?"确认订单已经超过15天，无法申请售后。":"商品已经全部退完，无商品可退。")):LT.alertSmall("网络异常，请稍后再试")},error:function(){}}),e.preventDefault()}),$(document).delegate(".shensu","click",function(e){if(!LT.isLogin())return!1;var t=$(this),a={acceptanceId:t.attr("data-acceptance_id")};$.ajax({url:window.ControllerSite+"/MyCenter/CheckCansafeguardRight",dataType:"json",type:"POST",data:a,success:function(e){"1"==e?location.href=window.ControllerSite+"/MyCenter/RefundDetail/?acceptanceId="+a.acceptanceId:"2"==e?LT.alertSmall("请到退货退款页面进行二次申诉"):"0"==e&&LT.alertSmall("此商品暂时不能申诉")}}),e.preventDefault()}),$(document).delegate("#ConfirmReceipt_id","click",function(e){var a=this,n=$(a).attr("data-unfacceptance");"0"!=n?LT.confirmSmall("此订单仍有"+n+"张受理单商家未做处理，如果确认收货将是全单收货，您确认要收货吗？",function(e){1==e&&t._ReceiveSubmit($(a).attr("data-orderid"))}):t._ReceiveSubmit($(a).attr("data-orderid")),e.preventDefault()}),$(document).delegate(".ConfirmReceipt","click",function(e){var a=this,n=$(a).parents("tr").attr("data-unfacceptance");"0"!=n?LT.confirmSmall("此订单仍有"+n+"张受理单商家未做处理，如果确认收货将是全单收货，您确认要收货吗？",function(e){1==e&&t._ReceiveSubmit($(a).parents("tr").attr("data-orderid"))}):t._ReceiveSubmit($(a).parents("tr").attr("data-orderid")),e.preventDefault()}),$(".complain").click(function(e){if(!LT.isLogin())return!1;var a=$(this).attr("data-orderid");LT.Ajax({url:window.ControllerSite+"/MyCenter/GetComplainType",dataType:"json",type:"get",success:function(n){var i='<form id="form2" method="post" action="/MyCenter/ComplainSupplier">';i+='<table class="login_table">',i+="<tr>",i+='<th width="30%">请选择投诉类型</th><td width="70%"><div id="complainList" class="sel_box2 mr_5 f_l"><input type="hidden" name="ComplainType" value=""/><span id="span_Load">正在加载...<span></div></td>',i+="</tr>",i+='<tr><th valign="top">投诉说明</th><td><textarea  name="reason" placeholder="40个字以内" class="J_placeholder pertext w240 h70" data-highlight="highlight"></textarea></td></tr></table>',i+="</form>",$(this).dialogFn({title:"投诉卖家",type:"confirm",height:"200px",width:"630px",content:i,fixed:!1,btnText:["投诉卖家","取消"],showAfter:function(){$("#span_Load").hide(),$("#complainList").selectFn({data:n.data,textField:"type_name",valueField:"type_id",maxRow:10,change:function(){this.value?$("div[for='ComplainType']").hide():$("div[for='ComplainType']").show(),$("#form2").find('input[name="ComplainType"]').val(this.value)}})},callback:function(e){if(1==e){var n=this.id.find("form");if(t._validateComplain(n),n.submit(),!n.valid())return!0;{t._SubmittingComplainForm(n,a,"")}}}}),e.preventDefault()}})})},_ReceiveSubmit:function(e){LT.confirmSmall("我已收到货，同意支付货款给商家",function(t){1==t&&$.ajax({url:window.ControllerSite+"/MyCenter/ConfirmReceipt",dataType:"json",type:"POST",data:{orderId:e},success:function(e){LT.alertSmall(e.msg,function(t){1==e.state&&1==t&&location.reload()})},error:function(){}})})},_SubmittingForm:function(e,t){var a=e.attr("action"),n=e.find('input[name="needRefund"]'),i=e.find(".sel_span"),r=e.find('textarea[name="reason"]'),l={needRefund:n.val(),reasonId:i.attr("value"),reasonType:i.text(),reason:r.val(),orderid:t.data("orderid"),detailid:t.data("detailid")};$.ajax({url:a,dataType:"json",type:"POST",data:l,success:function(e){LT.alertSmall(e.msg,function(t){1==e.state&&1==t&&location.reload()})},error:function(){}})},_SubmittingComplainForm:function(e,t){var a=e.attr("action"),n=e.find(".sel_span"),i=e.find('textarea[name="reason"]'),r={complainTypeId:n.data("value"),complainTypeName:n.text(),reason:i.val(),orderid:t};$.ajax({url:a,dataType:"json",type:"POST",data:r,success:function(e){LT.alertSmall(e.msg)},error:function(){}})},_validateAcceptance:function(e){e.validate({submitHandler:function(){return!1},rules:{AcceptanceReason:{required:!0},reason:{required:!0,maxlength:40}},messages:{AcceptanceReason:{required:a.Required},reason:{required:a.Required,maxlength:a.Maxlength}}})},_validateComplain:function(e){e.validate({submitHandler:function(){return!1},rules:{ComplainType:{required:!0},reason:{required:!0}},messages:{ComplainType:{required:a.Required},reason:{required:a.Required}}})},_selectData:function(e,t){{var a=e.children("ul");e.children("span")}$.ajax({url:t,type:"GET",dataType:"json",success:function(e){1==e.state&&$.each(e.data,function(e,t){a.append('<li data-hover="hover" value='+t.reason_id+">"+t.reason+"</li>")})}})},_selectComplainTypeData:function(e,t){{var a=e.children("ul");e.children("span")}$.ajax({url:t,type:"GET",dataType:"json",success:function(e){1==e.state&&$.each(e.data,function(e,t){a.append('<li data-hover="hover" value='+t.type_id+">"+t.type_name+"</li>")})}})},_selectShow:function(e,t){var a=$(e.target),n=a.attr("value"),i=t.children("span").attr("value");return a.hasClass("hovername")?n==i?!1:(t.children("span").html(a.html()).attr("value",n),n):!1}};e=function(){for(var e in t)-1==e.indexOf("_")&&t[e]()}()},$(function(){LT.myOrder_refund4()});