!function(t){function e(e,n){var a=this;a.index=null,a.text=null,a.value=null,a.item=null,a.that=e,a.conf=n,a.temp=t('<div class="J_select"><div class="sel_div"><ul class="sel_ul"></ul><div class="scr_com sel_scroll"><div class="scr_monsemove sel_scroll_btn"></div> </div></div></div>'),a.ul=a.temp.find("ul"),a.init=function(){0==a.that.find("li").length&&a.setOptions(),a.that.prev().length>0&&"input"!=a.that.prev()[0].tagName.toLowerCase()&&a.that.append('<input type="text" name="J_sel_input" class="absolute hidden_input2" />'),a.appendDefault(),a.initSetVal(),a.setHeight(),a.bindEvent(),"function"==typeof a.conf.showAfter&&a.conf.showAfter.call(a)},a.init()}var n={notSubmit:!1,data:null,tips:"--请选择--",event:"click",temp:null,attr:null,textField:"text",valueField:"value",maxRow:5,value:null,change:null,showAfter:null,keydownCallback:null,callbackDocu:null};e.prototype={constructor:e,setHeight:function(){var t,e=this;t=e.conf.maxRow>e.that.find("li").length?e.that.find("li").length:e.conf.maxRow,e.that.find("div.sel_div").height(e.that.find("li[data-hover]").height()*t),e.that.find("div.scr_com").height(e.that.find("div.sel_div").height()-10)},setOptions:function(){var e,n=this,a=n.conf.data,i=[];0==n.temp.html().length&&(n.temp=t('<div class="J_select"><div class="sel_div"><ul class="sel_ul"></ul><div class="scr_com sel_scroll"><div class="scr_monsemove sel_scroll_btn"></div> </div></div></div>'),n.ul=n.temp.find("ul")),n.ul.html(""),a&&a.length>0&&void 0===a[0][n.conf.valueField]&&a.shift(),e=null!=n.conf.temp&&"string"===jQuery.type(n.conf.temp)&&n.conf.temp.length>0?n.conf.temp:-1==n.conf.textField.indexOf("{")?"{"+n.conf.textField+"}":n.conf.textField,t.isPlainObject(n.conf.attr)&&t.each(n.conf.attr,function(t,e){var n=t+"={"+e+"} ";i.push(n)}),i=i.join("");var l='<li data-hover="hover" data-value="{'+n.conf.valueField+'}" '+i+">"+e+"</li>";if(a)for(var o=0;o<a.length;o++)n.ul.append(LT.tpl(l,a[o]));n.that.html(n.temp)},initSetVal:function(){var e=this;if(""==t.trim(e.conf.tips)||null!=e.conf.value&&(0==e.conf.value||e.conf.value)){var n=e.that.find('li[data-value="'+e.conf.value+'"]');""==t.trim(e.conf.tips)&&0==n.length?(n=e.that.find("li[data-value]").eq(0),e.conf.index=0):e.conf.index=n.index(),e.index=e.conf.index,e.text=n.html(),e.value=n.attr("data-value"),e.conf.data&&(e.that[0].item=e.item=e.conf.data[e.index]),e.that.find("span.sel_span").html(e.text).attr("data-value",e.value)}0!=e.conf.value&&null==e.conf.value&&(e.index=0)},bindEvent:function(){var e=this;switch(n.event.toLowerCase()){case"click":e.that.unbind(e.conf.event).on(e.conf.event,function(n){var a=t(n.target).next(),i=a.find("li:contains("+e.conf.tips+")"),l=i.length?i:a.find("li:contains(请选择)");""==t(n.target).attr("data-value")?l.hide():l.show(),t(n.target).hasClass("sel_scroll")||t(n.target).hasClass("sel_scroll_btn")||e.that.trigger("_handler",[t(n.target)]),e.that.prev().length>0&&"input"==e.that.prev()[0].tagName.toLowerCase()&&("function"==typeof e.conf.keydownCallback&&e.conf.keydownCallback.call(e),e.conf.notSubmit||e.that.parents("form").submit()),n.stopPropagation(),n.preventDefault()}).unbind("_handler._handler").on("_handler._handler",function(t,n){e._handler(t,n)}).on("setOptions.setOptions",function(t,n){e.conf.data=n,e.setOptions(),e.appendDefault(),e.setHeight()}).on("setValue.setValue",function(t,n){e.conf.value=n,e.initSetVal()})}},_judge:function(t,e){return t.attr("data-value")==e.attr("data-value")?!1:t.attr("data-value")||""==t.attr("data-value")?!0:void 0},_handler:function(e,n){n.parents("li[data-hover]").length>0&&(n=n.parents("li[data-hover]"));var a=this,i=a.that.find("span.sel_span"),l=a._judge(n,i),o=n.html(),c=n.attr("data-value"),d={oViveWrap:a.that.find("div.sel_div"),oHideWrap:a.that.find("ul.sel_ul"),oScrollWrap:a.that.find("div.sel_scroll"),oScrollBox:a.that.find("div.sel_scroll_btn")},s=function(t,e,n){i.html(t).attr("data-value",e),a.index=n,a.text=t,a.value=e};a.that.prev().length>0&&"input"!=a.that.prev()[0].tagName.toLowerCase()?t.browser.msie&&a.that.children('input[name="J_sel_input"]').focus():t.browser.msie&&a.that.prev().focus(),l&&(s(o,c,n.index()),a.conf.data&&(a.that[0].item=a.item=a.conf.data[a.index]),"function"==typeof a.conf.change&&a.conf.change.call(a,e)),d.oViveWrap.attr("data-type","true"),t("div.sel_div").filter(function(){return t(this).attr("data-type")?void 0:!0}).hide().css({"z-index":0}).parents(".sel_box2 ,sel_box3").css({"z-index":0});var r=d.oHideWrap.children("li");if(oLiLen=r.length,oLiLen>0){var h=function(){r.eq(a.index).addClass("hovername").siblings().removeClass("hovername")},f=function(){a.index=d.oHideWrap.children("li.hovername").index()},u=function(){f(),0==a.index?a.index=oLiLen-1:--a.index,h(),x(-1,a.index)},v=function(){f(),a.index==oLiLen-1?a.index=0:++a.index,h(),x(1,a.index)},p=function(){"true"==a.that.find(".sel_div").data("type")&&(a.that.find(".sel_div").css({"z-index":0}).hide(),a.that.find(".sel_div").removeData("type"))},x=function(t,e){var n,i,l=d.oScrollWrap.height(),o=d.oScrollBox.height(),c=d.oHideWrap.children("li").length,s=l-o;i=a.conf.maxRow>c?c:a.conf.maxRow,n=1==t?d.oScrollBox.position().top+s/(c-i):d.oScrollBox.position().top-s/(c-i),0==e&&1==t?(d.oScrollBox.css({top:0}),d.oHideWrap.css({top:0})):e==oLiLen-1&&-1==t?(d.oScrollBox.css({top:s+"px"}),d.oHideWrap.css({top:-(d.oHideWrap.height()-i*a.that.find('li[data-hover="hover"]').outerHeight(!0))+"px"})):LT.direction({number:n,viveWrapEle:d.oViveWrap,hideWrapEle:d.oHideWrap,scrollWrapEle:d.oScrollWrap,that:d.oScrollBox,direction:"top"}),"function"==typeof a.conf.keydownCallback&&a.conf.keydownCallback.call(a)},m=LT.downBox(n,d.oViveWrap);m?a.that.find(".sel_div").data("type","true"):a.that.find(".sel_div").removeData("type"),"true"==a.that.find(".sel_div").data("type")?a.that.find(".sel_div").show():a.that.find(".sel_div").hide(),r.eq(a.index).addClass("hovername").siblings().removeClass("hovername"),m?t(document).unbind("click.c keydown.k").on("click.c",function(){p(),"function"==typeof a.conf.callbackDocu&&a.conf.callbackDocu.call(a,e),t(this).unbind("click.c keydown.k")}).on("keydown.k",function(t){switch(t.keyCode){case 38:u();break;case 40:v();break;case 13:s(r.eq(a.index).html(),r.eq(a.index).attr("data-value"),a.index),p(),"function"==typeof a.conf.change&&a.conf.change.call(a,t)}t.stopPropagation()}):t(document).unbind("click.c keydown.k")}d.oViveWrap.css({"z-index":4e3}).parents(".sel_box2 ,sel_box3").css({"z-index":4e3}),d.oViveWrap.attr("data-type",""),a._bindScroll(d)},appendDefault:function(){var e=this;if(0==e.that.find(".sel_span").length&&e.that.find(".J_select").prepend('<span data-value="" class="sel_span">'+e.conf.tips+"</span>"),""!=t.trim(e.conf.tips)&&(e.that.find('li[data-value=""]').length<=0&&e.that.find("ul.sel_ul").prepend('<li data-hover="hover" data-value="" >'+e.conf.tips+"</li>"),t.isArray(e.conf.data))){var n={};n[e.conf.textField]=e.conf.tips,e.conf.data.unshift(n)}},_bindScroll:function(t){var e=this;LT.scroll({oViweContainer:t.oViveWrap,oPanelContainer:t.oHideWrap,oScrollContainer:t.oScrollWrap,oScrollBtn:t.oScrollBox,height:e.conf.maxRow*e.that.find('li[data-hover="hover"]').outerHeight(!0),direction:"y"})}},t.fn.selectFn=function(a){var i=this.data("SelectFn");this.length<0||i||(a=t.extend({},n,a),this.each(function(){i=new e(t(this),a),t(this).data("SelectFn",i)}))},t.extend(t.fn,{getItem:function(){return t(this).data("SelectFn").item},getValue:function(){return t(this).data("SelectFn").value},getText:function(){return t(this).data("SelectFn").text},getIndex:function(){return t(this).data("SelectFn").index},setOptions:function(e){t(this).find("ul").css({top:"0px"}),t(this).find("ul.sel_ul li").remove(),t(this).trigger("setOptions",[e])},setValue:function(e){t(this).trigger("setValue",[e])}})}(jQuery);